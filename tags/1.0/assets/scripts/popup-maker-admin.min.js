var PopMakeAdmin; (function(){PopMakeAdmin={init:function(){jQuery("body.post-type-popup form#post").length&&(PopMakeAdmin.initialize_popup_page(),PopMakeAdmin.attachQuickSearchListeners(),PopMakeAdmin.attachTabsPanelListeners());jQuery("body.post-type-popup_theme form#post").length&&PopMakeAdmin.initialize_theme_page();PopMakeAdmin.initialize_color_pickers();PopMakeAdmin.initialize_range_sliders();PopMakeAdmin.initialize_marketing();jQuery(document).keydown(function(a){return"115"!==a.which&&"83"!==a.which||!a.ctrlKey&& !a.metaKey?!0:(a.preventDefault(),jQuery("body.post-type-popup form#post, body.post-type-popup_theme form#post").submit(),!1)})},initialize_marketing:function(){jQuery("#menu-posts-popup ul li:eq(-1)").addClass("popmake-menu-highlight");jQuery(".popmake-newsletter-optin").show();jQuery("#popmake_popup_share").removeClass("postbox");jQuery("#posts-filter").length?jQuery("#wpbody-content > .wrap > h2:first").after(jQuery(".popmake-newsletter-optin")):jQuery("#titlediv").length?jQuery("#titlediv").append(jQuery(".popmake-newsletter-optin")): jQuery(".about-text").length&&jQuery(".popmake-badge").length?jQuery(".nav-tab-wrapper").after(jQuery(".popmake-newsletter-optin")):jQuery("#poststuff .tabwrapper").length?jQuery("#poststuff .tabwrapper").prepend(jQuery(".popmake-newsletter-optin")):jQuery("#poststuff").length&&jQuery("#poststuff").prepend(jQuery(".popmake-newsletter-optin"));jQuery(".popmake-optin-dismiss").on("click",function(a){var b=jQuery(this);a.preventDefault();jQuery.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"popmake_optin", popmake_nonce:popmake_admin_ajax_nonce,optin_dismiss:!0,optin_name:b.data("optin-name"),optin_type:b.data("optin-type")}}).done(function(a){a.success&&b.parents(".popmake-optin").slideUp(function(){jQuery(this).remove()})})})},attachTabsPanelListeners:function(){jQuery("#poststuff").bind("click",function(a){var b,c,d=jQuery(a.target),f,g,h,k,e,n;if(d.hasClass("nav-tab-link"))b=d.data("type"),c=d.parents(".posttypediv, .taxonomydiv").first(),jQuery("input",c).removeAttr("checked"),jQuery(".tabs-panel-active", c).removeClass("tabs-panel-active").addClass("tabs-panel-inactive"),jQuery("#"+b,c).removeClass("tabs-panel-inactive").addClass("tabs-panel-active"),jQuery(".tabs",c).removeClass("tabs"),d.parent().addClass("tabs"),jQuery(".quick-search",c).focus(),a.preventDefault();else if(d.hasClass("select-all"))(a=/#(.*)$/.exec(a.target.href))&&a[1]&&(a=jQuery("#"+a[1]+" .tabs-panel-active .menu-item-title input"),a.length===a.filter(":checked").length?a.removeAttr("checked"):a.prop("checked",!0));else if(d.hasClass("submit-add-to-menu")){c= d.parents(".options");a=jQuery('.tabs-panel-active input[type="checkbox"]:checked',c);b=jQuery("textarea",c);f=jQuery(".tagchecklist",c);g=b.val().split(",");for(c=0;c<g.length;c+=1)g[c]=parseInt(g[c],10);a.each(function(){h=jQuery(this);k=parseInt(h.val(),10);e=h.parent("label").siblings(".menu-item-title").val();-1===jQuery.inArray(k,g)&&g.push(k);f.append('<span><a class="ntdelbutton" data-id="'+k+'">X</a> '+e+"</span>")});b.text(g.join(","))}else d.hasClass("ntdelbutton")&&(h=d,n=parseInt(h.data("id"), 10),c=d.parents(".options"),b=jQuery("textarea",c),f=jQuery(".tagchecklist",c),g=b.val().split(","),g=jQuery.grep(g,function(a){return a!==n}),h.parent("span").remove(),b.text(g.join(",")))})},attachQuickSearchListeners:function(){var a;jQuery(".quick-search").keypress(function(b){var c=jQuery(this);if(13===b.which)return PopMakeAdmin.updateQuickSearchResults(c),!1;a&&clearTimeout(a);a=setTimeout(function(){PopMakeAdmin.updateQuickSearchResults(c)},400)}).attr("autocomplete","off")},updateQuickSearchResults:function(a){var b, c,d=a.val();2>d.length||(b=a.parents(".tabs-panel"),c={action:"menu-quick-search","response-format":"markup",menu:null,"menu-settings-column-nonce":jQuery("#menu-settings-column-nonce").val(),q:d,type:a.attr("name")},jQuery(".spinner",b).show(),jQuery.post(ajaxurl,c,function(a){PopMakeAdmin.processQuickSearchQueryResponse(a,c,b)}))},processQuickSearchQueryResponse:function(a,b,c){var d,f,g=jQuery("form#post"),h={},k=/menu-item[(\[\^]\]*/;a=jQuery("<div>").html(a).find("li");var e;a.length?(a.each(function(){e= jQuery(this);if((d=k.exec(e.html()))&&d[1]){for(f=d[1];g.elements["menu-item["+f+"][menu-item-type]"]||h[f];)--f;h[f]=!0;f!==d[1]&&e.html(e.html().replace(new RegExp("menu-item\\["+d[1]+"\\]","g"),"menu-item["+f+"]"))}}),jQuery(".categorychecklist",c).html(a),jQuery(".spinner",c).hide(),jQuery('[name^="menu-item"]').removeAttr("name")):(jQuery(".categorychecklist",c).html("<li><p>noResultsFound</p></li>"),jQuery(".spinner",c).hide())},initialize_color_pickers:function(){var a=this;jQuery(".color-picker").wpColorPicker({clear:function(b){a.update_theme(); b=jQuery(b.currentTarget).prev();b.hasClass("background-color")&&b.parents("table").find(".background-opacity").hide()}})},initialize_range_sliders:function(){var a,b,c,d,f,g=jQuery('<input type="range"/>'),h=jQuery('<button class="popmake-range-plus">+</button>'),k=jQuery('<button class="popmake-range-minus">-</button>');jQuery(document).on("input",'input[type="range"]',function(){var a=jQuery(this);a.siblings(".popmake-range-manual").val(a.val())});jQuery(".popmake-range-manual").each(function(){var a= jQuery(this),b=a.data("force-minmax"),p=parseInt(a.prop("min"),0),m=parseInt(a.prop("max"),0),q=parseInt(a.prop("step"),0),l=parseInt(a.val(),0);c=g.clone();d=h.clone();f=k.clone();b&&l>m&&(l=m,a.val(l));c.prop({min:p||0,max:b||m&&m>l?m:1.5*l,step:q||1.5*l/100,value:l}).on("change input",function(){a.trigger("input")});a.next().after(f,d);a.before(c)});jQuery(document).on("click",".popmake-range-manual",function(){jQuery(this).removeProp("readonly")}).on("focusout",".popmake-range-manual",function(){jQuery(this).prop("readonly", !0)}).on("change",".popmake-range-manual",function(){var a=jQuery(this),b=parseInt(a.prop("max"),0),g=parseInt(a.prop("step"),0),d=a.data("force-minmax"),h=parseInt(a.val(),0);c=a.prev();d&&h>b&&(h=b,a.val(h));c.prop({max:d||b&&b>h?b:1.5*h,step:g||1.5*h/100,value:h})}).on("click",".popmake-range-plus",function(a){a.preventDefault();a=jQuery(this).siblings(".popmake-range-manual");var b=parseInt(a.prop("step"),0),b=parseInt(a.val(),0)+b;c=a.prev();a.val(b).trigger("input");c.val(b)}).on("click",".popmake-range-minus", function(a){a.preventDefault();a=jQuery(this).siblings(".popmake-range-manual");var b=parseInt(a.prop("step"),0),b=parseInt(a.val(),0)-b;c=a.prev();a.val(b).trigger("input");c.val(b)});a=document.createElement("input");a.setAttribute("type","range");"text"===a.type&&jQuery("input[type=range]").each(function(a,g){b=jQuery(g);c=jQuery("<div />").slider({min:parseInt(b.attr("min"),10)||0,max:parseInt(b.attr("max"),10)||100,value:parseInt(b.attr("value"),10)||0,step:parseInt(b.attr("step"),10)||1,slide:function(a, b){jQuery(this).prev("input").val(b.value)}});b.after(c).hide()})},initialize_popup_page:function(){var a=function(a){var b=a.siblings(".options");a.is(":checked")?(b.show(),"popup_targeting_condition_on_entire_site"===a.attr("id")?(b=a.parents("#popmake_popup_targeting_condition_fields").find('[id^="targeting_condition-exclude_on_"]'),a=a.parents(".targeting_condition").siblings(".targeting_condition"),a.hide(),jQuery("> *",a).prop("disabled",!0),b.show(),jQuery("> *",b).removeProp("disabled")): jQuery("*",b).removeProp("disabled")):(b.hide(),"popup_targeting_condition_on_entire_site"===a.attr("id")?(b=a.parents("#popmake_popup_targeting_condition_fields").find('[id^="targeting_condition-exclude_on_"]'),a=a.parents(".targeting_condition").siblings(".targeting_condition"),a.show(),jQuery("> *",a).removeProp("disabled"),b.hide(),jQuery("> *",b).prop("disabled",!0)):jQuery("*",b).prop("disabled",!0))},b=function(a){var b=a.parent().siblings('input[type="checkbox"]:first'),c=0<=b.attr("name").indexOf("exclude"), d=c?b.attr("name").replace("popup_targeting_condition_exclude_on_specific_",""):b.attr("name").replace("popup_targeting_condition_on_specific_",""),c=c?jQuery("#exclude_on_specific_"+d):jQuery("#on_specific_"+d);a.is(":checked")&&("true"===a.val()?(b.prop("checked",!0),c.show(),jQuery("*",c).removeProp("disabled")):""===a.val()&&(b.removeProp("checked"),c.hide(),jQuery("*",c).prop("disabled",!0)))},c=function(){"custom"===jQuery("#popup_display_size").val()?(jQuery(".custom-size-only").show(),jQuery(".responsive-size-only").hide(), jQuery("#popup_display_custom_height_auto").is(":checked")?jQuery(".custom-size-height-only").hide():jQuery(".custom-size-height-only").show()):(jQuery(".custom-size-only").hide(),"auto"!==jQuery("#popup_display_size").val()?jQuery(".responsive-size-only").show():jQuery(".responsive-size-only").hide())},d=function(){jQuery(".animation-speed, .animation-origin").hide();"fade"===jQuery("#popup_display_animation_type").val()?jQuery(".animation-speed").show():"none"!==jQuery("#popup_display_animation_type").val()&& jQuery(".animation-speed, .animation-origin").show()},f=function(){var a=jQuery("#popup_display_location"),b=a.parents("table"),a=a.val();jQuery("tr.top, tr.right, tr.left, tr.bottom",b).hide();0<=a.indexOf("top")&&jQuery("tr.top").show();0<=a.indexOf("left")&&jQuery("tr.left").show();0<=a.indexOf("bottom")&&jQuery("tr.bottom").show();0<=a.indexOf("right")&&jQuery("tr.right").show()};jQuery("#popuptitlediv").insertAfter("#titlediv");jQuery('[name^="menu-item"]').removeAttr("name");jQuery(document).on("keydown", "#popuptitle",function(a){9===(a.keyCode||a.which)&&(a.preventDefault(),jQuery("#title").focus())}).on("keydown","#title, #popuptitle",function(a){var b=a.keyCode||a.which;a.shiftKey||9!==b||(a.preventDefault(),a="title"===jQuery(this).attr("id")?"#popuptitle":"#insert-media-button",jQuery(a).focus())}).on("keydown","#popuptitle, #insert-media-button",function(a){var b=a.keyCode||a.which;a.shiftKey&&9===b&&(a.preventDefault(),a="popuptitle"===jQuery(this).attr("id")?"#title":"#popuptitle",jQuery(a).focus())}).on("submit", "#post",function(a){var b=jQuery("#title").val();if(0===b.length||0===b.replace(/\s/g,"").length)a.preventDefault(),jQuery("div#notice").remove(),jQuery("<div id='notice' class='error below-h2'><p>A name is required for all popups.</p></div>").insertAfter("h2"),jQuery("#title").focus(),jQuery("#ajax-loading").hide(),jQuery("#publish").removeClass("button-primary-disabled"),jQuery("#title").prop("required","required")}).on("change","#popup_display_size",function(){c()}).on("click","#popup_display_custom_height_auto", function(){c()}).on("change","#popup_display_animation_type",function(){d()}).on("change","#popup_display_location",function(){f()});jQuery('#popmake_popup_targeting_condition_fields .targeting_condition > input[type="checkbox"]').on("click",function(){a(jQuery(this))}).each(function(){a(jQuery(this))});jQuery('input[type="radio"][name*="radio_checkbox_"]').on("click",function(){b(jQuery(this))}).each(function(){b(jQuery(this))});jQuery(".posttypediv, .taxonomydiv").each(function(){var a=jQuery(this), b=jQuery("> ul li"),a=jQuery(".tabs-panel",a);b.removeClass("tabs");b.eq(0).addClass("tabs");a.removeClass("tabs-panel-active").addClass("tabs-panel-inactive").removeAttr("style");a.eq(0).removeClass("tabs-panel-inactive").addClass("tabs-panel-active")});c();d();f()},theme_page_listeners:function(){var a=this;jQuery(document).on("change","select.font-family",function(){jQuery("select.font-weight option, select.font-style option",jQuery(this).parents("table")).removeProp("selected");a.update_font_selectboxes()}).on("change", "select.font-weight, select.font-style",function(){a.update_font_selectboxes()}).on("change input focusout","select, input:not(.color-picker)",function(){a.update_theme()}).on("change","select.border-style",function(){var a=jQuery(this);"none"===a.val()?a.parents("table").find(".border-options").hide():a.parents("table").find(".border-options").show()}).on("change","#popup_theme_close_location",function(){var a=jQuery(this),c=a.parents("table");jQuery("tr.topleft, tr.topright, tr.bottomleft, tr.bottomright", c).hide();jQuery("tr."+a.val(),c).show()}).on("change, irischange",".color-picker",function(b){a.update_theme();b=jQuery(b.currentTarget);b.hasClass("background-color")&&b.parents("table").find(".background-opacity").show()})},update_theme:function(){var a=jQuery("[name^='popup_theme_']").serializeArray(),b={},c;for(c=0;a.length>c;c+=1)0===a[c].name.indexOf("popup_theme_")&&(b[a[c].name.replace("popup_theme_","")]=a[c].value);this.retheme_popup(b)},theme_preview_scroll:function(){var a=jQuery("#popmake-theme-editor .empreview, body.post-type-popup_theme form#post #popmake_popup_theme_preview"), b=a.parent(),c=a.offset().top-50;jQuery(window).on("scroll",function(){jQuery("> .postbox:visible",b).index(a)===jQuery("> .postbox:visible",b).length-1&&jQuery(window).scrollTop()>=c?a.css({left:a.offset().left,width:a.width(),height:a.height(),position:"fixed",top:50}):a.removeAttr("style")})},update_font_selectboxes:function(){return jQuery("select.font-family").each(function(){var a=jQuery(this),b=a.parents("table").find("select.font-weight"),c=a.parents("table").find("select.font-style"),d=b.find("option"), f=c.find("option");if(void 0!==popmake_google_fonts[a.val()]){if(a=popmake_google_fonts[a.val()],d.hide(),f.hide(),a.variants.length)for(d=0;a.variants.length>d;d+=1)"regular"===a.variants[d]?(jQuery('option[value="normal"]',b).show(),jQuery('option[value="normal"]',c).show()):(0<=a.variants[d].indexOf("italic")&&jQuery('option[value="italic"]',c).show(),jQuery('option[value="'+parseInt(a.variants[d],10)+'"]',b).show())}else d.show(),f.show();b.parents("tr:first").show();1>=b.find("option:visible").length? b.parents("tr:first").hide():b.parents("tr:first").show();c.parents("tr:first").show();1>=c.find("option:visible").length?c.parents("tr:first").hide():c.parents("tr:first").show()})},initialize_theme_page:function(){jQuery("#popuptitlediv").insertAfter("#titlediv");var a=jQuery("#popup_theme_close_location").parents("table");this.update_theme();this.theme_page_listeners();this.theme_preview_scroll();this.update_font_selectboxes();jQuery("select.border-style").each(function(){var a=jQuery(this);"none"=== a.val()?a.parents("table").find(".border-options").hide():a.parents("table").find(".border-options").show()});jQuery(".color-picker.background-color").each(function(){var a=jQuery(this);""===a.val()?a.parents("table").find(".background-opacity").hide():a.parents("table").find(".background-opacity").show()});jQuery("tr.topleft, tr.topright, tr.bottomleft, tr.bottomright",a).hide();switch(jQuery("#popup_theme_close_location").val()){case "topleft":jQuery("tr.topleft",a).show();break;case "topright":jQuery("tr.topright", a).show();break;case "bottomleft":jQuery("tr.bottomleft",a).show();break;case "bottomright":jQuery("tr.bottomright",a).show()}},retheme_popup:function(a){var b=jQuery(".empreview .example-popup-overlay"),c=jQuery(".empreview .example-popup"),d=jQuery(".title",c),f=jQuery(".content",c),g=jQuery(".close-popup",c),h="yes"===a.container_boxshadow_inset?"inset ":"",k="yes"===a.close_boxshadow_inset?"inset ":"",e;void 0!==popmake_google_fonts[a.title_font_family]&&(e="//fonts.googleapis.com/css?family="+ a.title_font_family,"normal"!==a.title_font_weight&&(e+=":"+a.title_font_weight),"italic"===a.title_font_style&&(-1===e.indexOf(":")&&(e+=":"),e+="italic"),jQuery("body").append('<link href="'+e+'" rel="stylesheet" type="text/css">'));void 0!==popmake_google_fonts[a.content_font_family]&&(e="//fonts.googleapis.com/css?family="+a.content_font_family,"normal"!==a.content_font_weight&&(e+=":"+a.content_font_weight),"italic"===a.content_font_style&&(-1===e.indexOf(":")&&(e+=":"),e+="italic"),jQuery("body").append('<link href="'+ e+'" rel="stylesheet" type="text/css">'));void 0!==popmake_google_fonts[a.close_font_family]&&(e="//fonts.googleapis.com/css?family="+a.close_font_family,"normal"!==a.close_font_weight&&(e+=":"+a.close_font_weight),"italic"===a.close_font_style&&(-1===e.indexOf(":")&&(e+=":"),e+="italic"),jQuery("body").append('<link href="'+e+'" rel="stylesheet" type="text/css">'));b.removeAttr("style").css({backgroundColor:this.convert_hex(a.overlay_background_color,a.overlay_background_opacity)});c.removeAttr("style").css({padding:a.container_padding+ "px",backgroundColor:this.convert_hex(a.container_background_color,a.container_background_opacity),borderStyle:a.container_border_style,borderColor:a.container_border_color,borderWidth:a.container_border_width+"px",borderRadius:a.container_border_radius+"px",boxShadow:h+a.container_boxshadow_horizontal+"px "+a.container_boxshadow_vertical+"px "+a.container_boxshadow_blur+"px "+a.container_boxshadow_spread+"px "+this.convert_hex(a.container_boxshadow_color,a.container_boxshadow_opacity)});d.removeAttr("style").css({color:a.title_font_color, lineHeight:a.title_line_height+"px",fontSize:a.title_font_size+"px",fontFamily:a.title_font_family,fontStyle:a.title_font_style,fontWeight:a.title_font_weight,textAlign:a.title_text_align,textShadow:a.title_textshadow_horizontal+"px "+a.title_textshadow_vertical+"px "+a.title_textshadow_blur+"px "+this.convert_hex(a.title_textshadow_color,a.title_textshadow_opacity)});f.removeAttr("style").css({color:a.content_font_color,fontFamily:a.content_font_family,fontStyle:a.content_font_style,fontWeight:a.content_font_weight}); g.html(a.close_text).removeAttr("style").css({padding:a.close_padding+"px",backgroundColor:this.convert_hex(a.close_background_color,a.close_background_opacity),color:a.close_font_color,lineHeight:a.close_line_height+"px",fontSize:a.close_font_size+"px",fontFamily:a.close_font_family,fontWeight:a.close_font_weight,fontStyle:a.close_font_style,borderStyle:a.close_border_style,borderColor:a.close_border_color,borderWidth:a.close_border_width+"px",borderRadius:a.close_border_radius+"px",boxShadow:k+ a.close_boxshadow_horizontal+"px "+a.close_boxshadow_vertical+"px "+a.close_boxshadow_blur+"px "+a.close_boxshadow_spread+"px "+this.convert_hex(a.close_boxshadow_color,a.close_boxshadow_opacity),textShadow:a.close_textshadow_horizontal+"px "+a.close_textshadow_vertical+"px "+a.close_textshadow_blur+"px "+this.convert_hex(a.close_textshadow_color,a.close_textshadow_opacity)});switch(a.close_location){case "topleft":g.css({top:a.close_position_top+"px",left:a.close_position_left+"px"});break;case "topright":g.css({top:a.close_position_top+ "px",right:a.close_position_right+"px"});break;case "bottomleft":g.css({bottom:a.close_position_bottom+"px",left:a.close_position_left+"px"});break;case "bottomright":g.css({bottom:a.close_position_bottom+"px",right:a.close_position_right+"px"})}jQuery(document).trigger("popmake-admin-retheme",[a])},serialize_form:function(a){var b={};jQuery("[name]",a).each(function(){var a=jQuery(this).attr("name"),d=jQuery(this).val(),a=a.split("["),f=b,g,h=a.length,k;for(g=0;g<h;g+=1)k=a[g].replace("]",""),f[k]|| (f[k]={}),g!==a.length-1?f=f[k]:g===a.length-1&&(f[k]=d)});return b},convert_hex:function(a,b){a=a.replace("#","");var c=parseInt(a.substring(0,2),16),d=parseInt(a.substring(2,4),16),f=parseInt(a.substring(4,6),16);return"rgba("+c+","+d+","+f+","+b/100+")"},debounce:function(a,b){var c;return function(){var d=this,f=arguments;window.clearTimeout(c);c=window.setTimeout(function(){a.apply(d,f)},b)}},throttle:function(a,b){var c=!1,d=function(){c=!1};return function(){c||(a(),window.setTimeout(d,b), c=!0)}}};jQuery(document).ready(function(){PopMakeAdmin.init()})})();